// Show/hide ask section based on turn
const askSection = document.getElementById('ask-section');
const isMyTurn = gameState.playerOrder?.[gameState.currentTurn]?.isYou;
askSection.style.display = (isMyTurn && gameState.status === 'playing') ? 'block' : 'none';

// Update in-game scoreboard
updateGameScoreboard();
}

function updateGameScoreboard() {
const container = document.getElementById('game-scoreboard-content');

if (!scoreboardData || scoreboardData.length === 0) {
    container.innerHTML = '<p>Scoreboard will update after the round...</p>';
    return;
}

const topPlayers = scoreboardData.slice(0, 3);
let html = '';

topPlayers.forEach((player, index) => {
    const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â';
    const onlineStatus = player.isOnline ? '' : ' (offline)';
    
    html += `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(255,255,255,0.05); margin: 0.25rem 0; border-radius: 5px;">
            <span>${medal} ${player.name}${onlineStatus}</span>
            <span class="score">${player.score}</span>
        </div>
    `;
});

container.innerHTML = html;
}

function updateDetailedScoreboard() {
// Update current scores tab
const currentTab = document.getElementById('detailed-scoreboard');
if (scoreboardData.length === 0) {
    currentTab.innerHTML = '<p>No data available yet.</p>';
} else {
    let html = '<table class="scoreboard-table">';
    html += '<thead><tr><th>Rank</th><th>Player</th><th>Score</th><th>Games</th><th>Win Rate</th><th>Imposter Rate</th></tr></thead>';
    html += '<tbody>';
    
    scoreboardData.forEach((player, index) => {
        const rankClass = index === 0 ? 'first' : index === 1 ? 'second' : index === 2 ? 'third' : '';
        const onlineStatus = player.isOnline ? '' : 'offline';
        const winRate = player.gamesPlayed > 0 ? ((player.gamesWon / player.gamesPlayed) * 100).toFixed(1) : '0';
        const imposterRate = player.timesImposter > 0 ? ((player.timesImposterWon / player.timesImposter) * 100).toFixed(1) : '0';
        
        html += `
            <tr>
                <td><span class="rank ${rankClass}">#${index + 1}</span></td>
                <td><span class="player-name ${onlineStatus}">${player.name}</span></td>
                <td><span class="score">${player.score}</span></td>
                <td>${player.gamesWon}/${player.gamesPlayed}</td>
                <td>${winRate}%</td>
                <td>${imposterRate}%</td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    currentTab.innerHTML = html;
}

// Update game history tab
const historyTab = document.getElementById('game-history-content');
if (gameHistory.length === 0) {
    historyTab.innerHTML = '<p>No games completed yet.</p>';
} else {
    let html = '<div class="game-history">';
    gameHistory.slice().reverse().forEach(game => {
        html += `
            <div class="history-item">
                <h4>Game #${game.gameNumber} - ${new Date(game.date).toLocaleString()}</h4>
                <p><strong>Location:</strong> ${game.location}</p>
                <p><strong>Imposter:</strong> ${game.imposter}</p>
                <p><strong>Winner:</strong> ${game.winner === 'imposter_wins' ? 'Imposter' : 'Location Team'}</p>
                <p><strong>Rounds:</strong> ${game.rounds}</p>
                <details>
                    <summary>Final Scores</summary>
                    ${game.finalScores.map(score => `<p>${score.name}: ${score.score}</p>`).join('')}
                </details>
            </div>
        `;
    });
    html += '</div>';
    historyTab.innerHTML = html;
}

// Update detailed stats tab
const statsTab = document.getElementById('detailed-stats-content');
if (scoreboardData.length === 0) {
    statsTab.innerHTML = '<p>No stats available yet.</p>';
} else {
    let html = '<table class="scoreboard-table">';
    html += '<thead><tr><th>Player</th><th>Questions Asked</th><th>Questions Answered</th><th>Vote Accuracy</th><th>Rounds Survived</th></tr></thead>';
    html += '<tbody>';
    
    scoreboardData.forEach(player => {
        const voteAccuracy = player.totalVotes > 0 ? ((player.correctVotes / player.totalVotes) * 100).toFixed(1) : '0';
        const onlineStatus = player.isOnline ? '' : 'offline';
        
        html += `
            <tr>
                <td><span class="player-name ${onlineStatus}">${player.name}</span></td>
                <td>${player.questionsAsked}</td>
                <td>${player.questionsAnswered}</td>
                <td>${voteAccuracy}% (${player.correctVotes}/${player.totalVotes})</td>
                <td>${player.roundsSurvived}</td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    statsTab.innerHTML = html;
}
}

function generateRoundSummary(roundData) {
let html = `<div class="round-summary">`;
html += `<h4>üìä Round ${roundData.round} Complete!</h4>`;
html += `<p>Here's how everyone performed this round:</p>`;

html += '<table class="scoreboard-table" style="margin-top: 1rem;">';
html += '<thead><tr><th>Player</th><th>Score</th><th>Score Change</th></tr></thead>';
html += '<tbody>';

roundData.scoreboard.forEach(player => {
    const currentPlayer = scoreboardData.find(p => p.name === player.name);
    const scoreChange = currentPlayer ? currentPlayer.score - player.score : 0;
    const changeText = scoreChange > 0 ? `+${scoreChange}` : scoreChange.toString();
    const changeColor = scoreChange > 0 ? '#27ae60' : scoreChange < 0 ? '#e74c3c' : '#95a5a6';
    
    html += `
        <tr>
            <td>${player.name}</td>
            <td>${currentPlayer ? currentPlayer.score : player.score}</td>
            <td style="color: ${changeColor};">${changeText}</td>
        </tr>
    `;
});

html += '</tbody></table>';
html += `</div>`;

return html;
}<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üïµÔ∏è The Mole - Multiplayer</title>
<script src="/socket.io/socket.io.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #1a1a2e, #16213e);
color: white;
min-height: 100vh;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

.title {
text-align: center;
font-size: 3rem;
margin-bottom: 2rem;
text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

.screen {
display: none;
animation: fadeIn 0.5s ease-in;
}

.screen.active {
display: block;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

.card {
background: rgba(15, 52, 96, 0.8);
border-radius: 15px;
padding: 2rem;
margin: 1rem 0;
border: 2px solid rgba(255, 255, 255, 0.1);
backdrop-filter: blur(10px);
}

.input-group {
margin: 1rem 0;
}

.input-group label {
display: block;
margin-bottom: 0.5rem;
font-weight: bold;
}

.input-group input, .input-group select, .input-group textarea {
width: 100%;
padding: 12px;
border: none;
border-radius: 8px;
background: rgba(255, 255, 255, 0.1);
color: white;
font-size: 1rem;
}

.input-group input::placeholder, .input-group textarea::placeholder {
color: rgba(255, 255, 255, 0.6);
}

.btn {
background: linear-gradient(45deg, #3498db, #2980b9);
color: white;
border: none;
padding: 12px 24px;
border-radius: 8px;
cursor: pointer;
font-size: 1rem;
font-weight: bold;
transition: all 0.3s ease;
margin: 0.5rem;
}

.btn:hover {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
}

.btn-primary { background: linear-gradient(45deg, #27ae60, #2ecc71); }
.btn-danger { background: linear-gradient(45deg, #e74c3c, #c0392b); }
.btn-warning { background: linear-gradient(45deg, #f39c12, #e67e22); }
.btn-info { background: linear-gradient(45deg, #8e44ad, #9b59b6); }

.players-list {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 1rem;
margin: 1rem 0;
}

.player-card {
background: rgba(52, 73, 94, 0.8);
padding: 1rem;
border-radius: 10px;
text-align: center;
border: 2px solid transparent;
transition: all 0.3s ease;
}

.player-card.host {
border-color: #f39c12;
}

.player-card.ready {
border-color: #27ae60;
}

.player-card.current-turn {
border-color: #e74c3c;
animation: pulse 2s infinite;
}

@keyframes pulse {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.05); }
}

.game-info {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 1rem;
margin: 1rem 0;
}

.info-card {
background: rgba(52, 73, 94, 0.6);
padding: 1rem;
border-radius: 10px;
text-align: center;
}

.question-section {
background: rgba(26, 26, 46, 0.8);
padding: 1.5rem;
border-radius: 10px;
margin: 1rem 0;
}

.game-log {
background: rgba(52, 73, 94, 0.4);
padding: 1rem;
border-radius: 10px;
height: 300px;
overflow-y: auto;
margin: 1rem 0;
font-family: monospace;
font-size: 0.9rem;
}

.log-entry {
margin: 0.5rem 0;
padding: 0.5rem;
border-radius: 5px;
background: rgba(255, 255, 255, 0.05);
}

.voting-section {
background: rgba(231, 76, 60, 0.2);
padding: 1.5rem;
border-radius: 10px;
margin: 1rem 0;
border: 2px solid rgba(231, 76, 60, 0.5);
}

.locations-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 0.5rem;
margin: 1rem 0;
font-size: 0.9rem;
}

.location-item {
background: rgba(255, 255, 255, 0.1);
padding: 0.5rem;
border-radius: 5px;
text-align: center;
}

.error {
background: rgba(231, 76, 60, 0.2);
border: 1px solid #e74c3c;
color: #e74c3c;
padding: 1rem;
border-radius: 8px;
margin: 1rem 0;
}

.success {
background: rgba(39, 174, 96, 0.2);
border: 1px solid #27ae60;
color: #27ae60;
padding: 1rem;
border-radius: 8px;
margin: 1rem 0;
}

.role-display {
font-size: 1.2rem;
font-weight: bold;
padding: 1rem;
border-radius: 10px;
text-align: center;
margin: 1rem 0;
}

.role-imposter {
background: rgba(231, 76, 60, 0.3);
border: 2px solid #e74c3c;
color: #e74c3c;
}

.role-location {
background: rgba(39, 174, 96, 0.3);
border: 2px solid #27ae60;
color: #27ae60;
}

.scoreboard {
background: rgba(15, 52, 96, 0.8);
border-radius: 15px;
padding: 1.5rem;
margin: 1rem 0;
border: 2px solid rgba(255, 255, 255, 0.1);
}

.scoreboard-table {
width: 100%;
border-collapse: collapse;
margin-top: 1rem;
}

.scoreboard-table th,
.scoreboard-table td {
padding: 0.75rem;
text-align: left;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.scoreboard-table th {
background: rgba(255, 255, 255, 0.1);
font-weight: bold;
text-transform: uppercase;
font-size: 0.9rem;
}

.scoreboard-table tr:hover {
background: rgba(255, 255, 255, 0.05);
}

.rank {
font-weight: bold;
color: #f39c12;
}

.rank.first { color: #f1c40f; }
.rank.second { color: #95a5a6; }
.rank.third { color: #e67e22; }

.player-name {
font-weight: bold;
}

.player-name.offline {
opacity: 0.6;
font-style: italic;
}

.score {
font-weight: bold;
color: #27ae60;
font-size: 1.1rem;
}

.stats {
font-size: 0.9rem;
color: rgba(255, 255, 255, 0.8);
}

.scoreboard-tabs {
display: flex;
margin-bottom: 1rem;
}

.tab-btn {
background: rgba(255, 255, 255, 0.1);
border: none;
color: white;
padding: 0.75rem 1.5rem;
cursor: pointer;
border-radius: 8px 8px 0 0;
margin-right: 0.5rem;
transition: all 0.3s ease;
}

.tab-btn.active {
background: rgba(52, 152, 219, 0.6);
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

.game-history {
max-height: 300px;
overflow-y: auto;
}

.history-item {
background: rgba(255, 255, 255, 0.05);
padding: 1rem;
margin: 0.5rem 0;
border-radius: 8px;
border-left: 4px solid #3498db;
}

.round-summary {
background: rgba(39, 174, 96, 0.2);
padding: 1rem;
border-radius: 8px;
margin: 1rem 0;
border: 1px solid rgba(39, 174, 96, 0.4);
}

.round-summary h4 {
color: #27ae60;
margin-bottom: 0.5rem;
}